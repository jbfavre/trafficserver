--- a/plugins/header_rewrite/lulu.h
+++ b/plugins/header_rewrite/lulu.h
@@ -48,9 +48,36 @@ uint16_t getPort(sockaddr const *s_socka
 #define rmb() __asm__ __volatile__("sync" : : : "memory")
 #define wmb() __asm__ __volatile__("" : : : "memory")
 #elif defined(__arm__)
-#define mb() __asm__ __volatile__("dmb" : : : "memory")
-#define rmb() __asm__ __volatile__("dmb" : : : "memory")
-#define wmb() __asm__ __volatile__("" : : : "memory")
+  #if defined(__ARM_ARCH_4__) \
+     || defined(__ARM_ARCH_4T__) \
+     || defined(__ARM_ARCH_5__) \
+     || defined(__ARM_ARCH_5E__)  \
+     || defined(__ARM_ARCH_5T__) \
+     || defined(__ARM_ARCH_5TE__) \
+     || defined(__ARM_ARCH_5TEJ__) \
+     || defined(__ARM_ARCH_6__) \
+     || defined __ARM_ARCH_6J__  \
+     || defined(__ARM_ARCH_6K__) \
+     || defined(__ARM_ARCH_6Z) \
+     || defined(__ARM_ARCH_6ZK__) \
+     || defined(__ARM_ARCH_6T2__)
+    #if defined(__thumb__)
+      // This is just a placeholder and almost certainly not sufficient.
+      #define mb() __asm__ __volatile__ ("" : : : "memory");
+      #define rmb() __asm__ __volatile__("" : : : "memory")
+      #define wmb() __asm__ __volatile__("" : : : "memory")
+    #else // defined(__thumb__)
+      int a = 0, b = 0;
+      #define mb() __asm__ __volatile__ ("mcr p15,0,%0,c7,c10,5" : : "r" (0) : "memory")
+      #define rmb() mb()
+      #define wmb() __asm__ __volatile__("" : : : "memory")
+    #endif // defined(__thumb__)
+  #else
+    // ARMv7 and later.
+    #define mb() __asm__ __volatile__("dmb" : : : "memory")
+    #define rmb() __asm__ __volatile__("dmb" : : : "memory")
+    #define wmb() __asm__ __volatile__("" : : : "memory")
+  #endif
 #elif defined(__mips__)
 #define mb() __asm__ __volatile__("sync" : : : "memory")
 #define rmb() __asm__ __volatile__("sync" : : : "memory")
